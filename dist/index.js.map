{
  "version": 3,
  "sources": ["../index.ts"],
  "sourcesContent": ["// Datastar Attribute Plugin: data-on-keys\n// Custom attribute to bind actions to key presses\n\nimport type { AttributePlugin } from 'datastar/library/src/engine/types'\n\n// Auto-register with datastar if available from importmap\nif (typeof window !== 'undefined') {\n    // Try to import datastar dynamically if it's available via importmap\n    (async () => {\n        try {\n            // @ts-ignore - datastar may be available via importmap at runtime\n            const datastar = await import('datastar')\n            if (datastar?.attribute) {\n                datastar.attribute(onKeysPlugin(datastar.beginBatch, datastar.endBatch))\n            }\n        } catch (e) {\n            // Datastar not available via importmap, plugin needs manual registration\n        }\n    })()\n}\n\n// Helper function to parse key combinations\nfunction parseKeyCombo(keyCombo: string): { key: string; modifiers: { ctrl?: boolean; alt?: boolean; shift?: boolean; meta?: boolean } } {\n    // Use - for key combinations: ctrl-k\n    const parts = keyCombo.toLowerCase().split('-').map(p => p.trim());\n    const modifiers: { ctrl?: boolean; alt?: boolean; shift?: boolean; meta?: boolean } = {};\n    let key = '';\n\n    for (const part of parts) {\n        switch (part) {\n            case 'ctrl':\n            case 'control':\n                modifiers.ctrl = true;\n                break;\n            case 'alt':\n                modifiers.alt = true;\n                break;\n            case 'shift':\n                modifiers.shift = true;\n                break;\n            case 'meta':\n            case 'cmd':\n            case 'command':\n                modifiers.meta = true;\n                break;\n            default:\n                key = part;\n                break;\n        }\n    }\n\n    return { key, modifiers };\n}\n\n// Helper function to normalize key names\nfunction normalizeKey(key: string): string {\n    // For single letter keys, keep them as-is (lowercase)\n    if (key.length === 1 && /[a-z]/.test(key)) {\n        return key;\n    }\n    \n    const capitalized = key.charAt(0).toUpperCase() + key.slice(1).toLowerCase();\n    const keyMap: Record<string, string> = {\n        'Space': ' ',\n        'Return': 'Enter',\n        'Esc': 'Escape',\n        'Del': 'Delete',\n        'Pageup': 'PageUp',\n        'Pagedown': 'PageDown',\n        'Up': 'ArrowUp',\n        'Down': 'ArrowDown',\n        'Left': 'ArrowLeft',\n        'Right': 'ArrowRight',\n    };\n\n    return keyMap[capitalized] || capitalized;\n}\n\n// Helper function to check if event matches key combination\nfunction matchesKeyCombo(event: KeyboardEvent, keyCombo: string): boolean {\n    const { key, modifiers } = parseKeyCombo(keyCombo);\n    \n    // Normalize both the target key and the event key\n    const eventKey = event.key;\n    const targetKey = normalizeKey(key);\n    \n    if (eventKey !== targetKey) {\n        return false;\n    }\n\n    // Check modifiers\n    if (!!modifiers.ctrl !== event.ctrlKey) return false;\n    if (!!modifiers.alt !== event.altKey) return false;\n    if (!!modifiers.shift !== event.shiftKey) return false;\n    if (!!modifiers.meta !== event.metaKey) return false;\n\n    return true;\n}\n\nexport default function onKeysPlugin(beginBatch: () => void, endBatch: () => void): AttributePlugin {\n    return {\n        name: 'on-keys',\n        requirement: {\n            value: 'must',\n        },\n        argNames: ['evt'],\n        returnsValue: true,\n        apply({ el, key, mods, rx }: { el: Element; key: string; mods: Modifiers; rx: (event?: Event) => void }) {\n            // Parse key combinations from the key parameter\n            // Support formats like: \"esc\", \"alt-q\", \"ctrl-shift-s\", \"esc.alt-q.enter\"\n            const keySpecs = key ? key.split('.').map((k: string) => k.trim()) : [];\n            \n            // Default to window target, use element only when __el modifier is present\n            let target: Element | Window | Document = window;\n            if (mods.has('el')) target = el;\n            \n            // Create the core callback that will be wrapped with modifiers\n            let callback = (evt?: Event) => {\n                beginBatch();\n                rx(evt);\n                endBatch();\n            }\n            \n            // Apply timing and view transition modifiers\n            callback = modifyViewTransition(callback, mods);\n            callback = modifyTiming(callback, mods);\n            \n            // Create the event handler that checks keys and calls the modified callback\n            const eventHandler = (evt?: Event) => {\n                if (evt) {\n                    // Only check key matching for keyboard events\n                    if (!(evt instanceof KeyboardEvent)) {\n                        return;\n                    }\n                    // Check if any of the specified key combinations match\n                    let shouldTrigger = false;\n                    \n                    if (keySpecs.length === 0) {\n                        // If no specific keys specified, trigger on any key\n                        shouldTrigger = true;\n                    } else {\n                        // Check each key specification\n                        for (const keySpec of keySpecs) {\n                            if (matchesKeyCombo(evt, keySpec)) {\n                                shouldTrigger = true;\n                                break;\n                            }\n                        }\n                    }\n                     \n                    if (!shouldTrigger) {\n                        return;\n                    }\n\n                    // Prevent default behavior by default, unless noprevent modifier is used\n                    if (!mods.has('noprevent') && typeof key !== 'undefined') {\n                        evt.preventDefault();\n                    }\n                    if (mods.has('stop')) {\n                        evt.stopPropagation();\n                    }\n                }\n                \n                // Execute the modified callback (which may be wrapped with timing/view transition)\n                callback(evt);\n            }\n            \n            const evtListOpts: AddEventListenerOptions = {\n                capture: mods.has('capture'),\n                passive: mods.has('passive'),\n                once: mods.has('once'),\n            }\n            const eventType = mods.has('up') ? 'keyup' : 'keydown';\n            \n            target.addEventListener(eventType, eventHandler, evtListOpts);\n            return () => {\n                target.removeEventListener(eventType, eventHandler, evtListOpts);\n            }\n        }\n    } as AttributePlugin;\n}\n\nimport type { EventCallbackHandler, Modifiers } from 'datastar/library/src/engine/types'\n\n// https://github.com/starfederation/datastar-pro/blob/3d9a83f79e2c940e1e14dd996a36bb79e98800dd/library/src/utils/view-transitions.ts\nexport const modifyViewTransition = (callback: EventCallbackHandler, mods: Modifiers): EventCallbackHandler => {\n  if (mods.has('viewtransition') && !!document.startViewTransition) {\n    const cb = callback\n    callback = (...args: any[]) =>\n      document.startViewTransition(() => cb(...args))\n  }\n\n  return callback   \n}\n\n// https://github.com/starfederation/datastar-pro/blob/3d9a83f79e2c940e1e14dd996a36bb79e98800dd/library/src/utils/timing.ts\nconst delay = (\n  callback: EventCallbackHandler,\n  wait: number,\n): EventCallbackHandler => {\n  return (...args: any[]) => {\n    setTimeout(() => {\n      callback(...args)\n    }, wait)\n  }\n}\n\nconst debounce = (\n  callback: EventCallbackHandler,\n  wait: number,\n  leading = false,\n  trailing = true,\n): EventCallbackHandler => {\n  let timer: ReturnType<typeof setTimeout> | number = 0\n  return (...args: any[]) => {\n    timer && clearTimeout(timer)\n\n    if (leading && !timer) {\n      callback(...args)\n    }\n\n    timer = setTimeout(() => {\n      if (trailing) {\n        callback(...args)\n      }\n      timer && clearTimeout(timer)\n      timer = 0\n    }, wait)\n  }\n}\n\nconst throttle = (\n  callback: EventCallbackHandler,\n  wait: number,\n  leading = true,\n  trailing = false,\n): EventCallbackHandler => {\n  let waiting = false\n\n  return (...args: any[]) => {\n    if (waiting) return\n\n    if (leading) {\n      callback(...args)\n    }\n\n    waiting = true\n    setTimeout(() => {\n      if (trailing) {\n        callback(...args)\n      }\n      waiting = false\n    }, wait)\n  }\n}\n\nexport const modifyTiming = (\n  callback: EventCallbackHandler,\n  mods: Modifiers,\n): EventCallbackHandler => {\n  const delayArgs = mods.get('delay')\n  if (delayArgs) {\n    const wait = tagToMs(delayArgs)\n    callback = delay(callback, wait)\n  }\n\n  const debounceArgs = mods.get('debounce')\n  if (debounceArgs) {\n    const wait = tagToMs(debounceArgs)\n    const leading = tagHas(debounceArgs, 'leading', false)\n    const trailing = !tagHas(debounceArgs, 'notrailing', false)\n    callback = debounce(callback, wait, leading, trailing)\n  }\n\n  const throttleArgs = mods.get('throttle')\n  if (throttleArgs) {\n    const wait = tagToMs(throttleArgs)\n    const leading = !tagHas(throttleArgs, 'noleading', false)\n    const trailing = tagHas(throttleArgs, 'trailing', false)\n    callback = throttle(callback, wait, leading, trailing)\n  }\n\n  return callback\n}\n\n// https://github.com/starfederation/datastar-pro/blob/3d9a83f79e2c940e1e14dd996a36bb79e98800dd/library/src/utils/tags.ts\nconst tagToMs = (args: Set<string>) => {\n  if (!args || args.size <= 0) return 0\n  for (const arg of args) {\n    if (arg.endsWith('ms')) {\n      return +arg.replace('ms', '')\n    }\n    if (arg.endsWith('s')) {\n      return +arg.replace('s', '') * 1000\n    }\n    try {\n      return Number.parseFloat(arg)\n    } catch (_) {}\n  }\n  return 0\n}\n\nconst tagHas = (\n  tags: Set<string>,\n  tag: string,\n  defaultValue = false,\n) => {\n  if (!tags) return defaultValue\n  return tags.has(tag.toLowerCase())\n}\n"],
  "mappings": "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",
  "names": ["datastar", "onKeysPlugin", "parseKeyCombo", "keyCombo", "parts", "p", "modifiers", "key", "part", "normalizeKey", "capitalized", "matchesKeyCombo", "event", "eventKey", "targetKey", "beginBatch", "endBatch", "el", "mods", "rx", "keySpecs", "k", "target", "callback", "evt", "modifyViewTransition", "modifyTiming", "eventHandler", "shouldTrigger", "keySpec", "evtListOpts", "eventType", "cb", "args", "delay", "wait", "debounce", "leading", "trailing", "timer", "throttle", "waiting", "delayArgs", "tagToMs", "debounceArgs", "tagHas", "throttleArgs", "arg", "tags", "tag", "defaultValue"]
}
